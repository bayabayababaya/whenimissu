<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊÄùÂøµÂÆπÂô®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(180deg, #F5F5F7 0%, #FAFAFA 100%);
            color: #1D1D1F;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .page {
            display: none;
            width: 100%;
            max-width: 680px;
        }

        .page.active {
            display: block;
        }

        /* È¶ñÈ°µÊ†∑Âºè */
        .home-page {
            text-align: center;
        }

        .heart-icon {
            font-size: 56px;
            margin-bottom: 24px;
            color: #6366F1;
            opacity: 0.9;
            filter: drop-shadow(0 2px 8px rgba(99, 102, 241, 0.15));
        }

        .title-greeting {
            font-size: 17px;
            margin-bottom: 32px;
            color: #6B7280;
            text-align: center;
            min-height: 1.5em;
            font-weight: 400;
            letter-spacing: -0.2px;
            line-height: 1.5;
        }

        .clock {
            font-size: 64px;
            font-weight: 200;
            margin-bottom: 48px;
            letter-spacing: 2px;
            color: #1D1D1F;
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            font-variant-numeric: tabular-nums;
            opacity: 0.85;
        }

        .buttons-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 48px;
        }

        .button-row {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
            position: relative;
        }

        .emotion-btn {
            padding: 14px 28px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.08);
            color: #1D1D1F;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 100px;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .emotion-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            border-color: rgba(99, 102, 241, 0.3);
            color: #6366F1;
        }

        .emotion-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .text-input {
            flex: 1;
            max-width: 300px;
            padding: 14px 16px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            font-size: 15px;
            color: #1D1D1F;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .text-input:focus {
            outline: none;
            border-color: #6366F1;
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1), 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .text-input::placeholder {
            color: #9CA3AF;
        }

        .submit-btn {
            padding: 14px 24px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            color: #6366F1;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            width: 80px;
            text-align: center;
            box-sizing: border-box;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1);
        }

        .submit-btn:hover {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.2);
        }

        .submit-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1);
        }

        /* +1 Âä®ÁîªÊ†∑Âºè */
        .plus-one {
            position: absolute;
            color: #6366F1;
            font-size: 18px;
            font-weight: 600;
            pointer-events: none;
            z-index: 1000;
            animation: floatUp 1s ease-out forwards;
            opacity: 0.9;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-30px) scale(1.2);
            }
        }

        .question-section {
            margin-top: 48px;
            padding: 32px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
        }

        .question-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 17px;
            color: #1D1D1F;
            flex: 1;
            font-weight: 500;
            line-height: 1.5;
        }

        .refresh-btn {
            padding: 10px 18px;
            background: rgba(99, 102, 241, 0.08);
            border: 1px solid rgba(99, 102, 241, 0.15);
            color: #6366F1;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            margin-left: 12px;
        }

        .refresh-btn:hover {
            background: rgba(99, 102, 241, 0.12);
            border-color: rgba(99, 102, 241, 0.25);
            transform: translateY(-1px);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .question-submit-container {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
        }

        .question-submit-btn {
            padding: 12px 24px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            color: #6366F1;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            width: 110px;
            text-align: center;
            box-sizing: border-box;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1);
        }

        .question-submit-btn:hover {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.2);
        }

        .question-submit-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1);
        }

        .question-submit-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .question-submit-btn:disabled:hover {
            background: rgba(99, 102, 241, 0.1);
            color: #6366F1;
            transform: none;
        }

        .answer-input {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 16px;
            font-size: 15px;
            color: #1D1D1F;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            resize: vertical;
            font-family: inherit;
            line-height: 1.6;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .answer-input:focus {
            outline: none;
            border-color: #6366F1;
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1), 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .share-btn {
            margin-top: 32px;
            padding: 14px 32px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            color: #6366F1;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1);
        }

        .share-btn:hover {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.2);
        }

        .clear-btn {
            margin-top: 12px;
            padding: 14px 32px;
            background: rgba(239, 68, 68, 0.08);
            border: 1px solid rgba(239, 68, 68, 0.15);
            color: #EF4444;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.1);
        }

        .clear-btn:hover {
            background: rgba(239, 68, 68, 0.12);
            border-color: rgba(239, 68, 68, 0.25);
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(239, 68, 68, 0.2);
        }

        .share-section {
            margin-top: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .share-input-container {
            display: flex;
            gap: 10px;
            width: 100%;
            max-width: 600px;
            align-items: center;
        }

        .share-input {
            flex: 1;
            padding: 14px 16px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            font-size: 15px;
            color: #1D1D1F;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .share-input:focus {
            outline: none;
            border-color: #6366F1;
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1), 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .share-input::placeholder {
            color: #9CA3AF;
        }

        .load-btn {
            padding: 14px 24px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            color: #6366F1;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1);
        }

        .load-btn:hover {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.2);
        }

        /* Â§çÁõòÈ°µÈù¢Ê†∑Âºè */
        .review-page {
            padding: 40px 20px;
        }

        .review-header {
            text-align: center;
            margin-bottom: 48px;
            font-size: 32px;
            font-weight: 300;
            color: #1D1D1F;
            letter-spacing: -0.5px;
        }

        .review-container {
            margin-bottom: 40px;
        }

        .review-header-section {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }

        .column-title {
            font-size: 18px;
            text-align: center;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            flex: 1;
            color: #1D1D1F;
            font-weight: 500;
        }

        .timeline {
            position: relative;
            padding: 20px 0;
            max-width: 1000px;
            margin: 0 auto;
        }

        .timeline-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 1px;
            background: linear-gradient(180deg, rgba(99, 102, 241, 0.2) 0%, rgba(99, 102, 241, 0.4) 100%);
            transform: translateX(-50%);
            z-index: 1;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 24px;
            padding: 20px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
        }

        .timeline-item.left {
            margin-right: calc(50% + 10px);
            padding-right: 20px;
            text-align: right;
            max-width: calc(50% - 10px);
        }

        .timeline-item.right {
            margin-left: calc(50% + 10px);
            padding-left: 20px;
            text-align: left;
            max-width: calc(50% - 10px);
        }

        /* Âêå‰∏ÄÊó∂Èó¥ÁÇπÁöÑËÆ∞ÂΩïÂÆπÂô® */
        .timeline-row {
            position: relative;
            margin-bottom: 30px;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 20px;
            width: 100%;
        }

        .timeline-row .timeline-item {
            flex: 0 0 calc(50% - 10px);
            margin: 0;
            min-width: 0;
        }

        .timeline-row .timeline-item.left {
            margin-right: 0;
            text-align: right;
        }

        .timeline-row .timeline-item.right {
            margin-left: 0;
            text-align: left;
        }

        .timeline-item-placeholder {
            flex: 0 0 calc(50% - 10px);
            visibility: hidden;
        }

        .timeline-item.miracle {
            background: rgba(99, 102, 241, 0.08);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: 0 4px 24px rgba(99, 102, 241, 0.15), 0 2px 12px rgba(0, 0, 0, 0.06);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .timeline-item.miracle::before {
            content: '‚ú®';
            position: absolute;
            top: -10px;
            font-size: 20px;
            z-index: 10;
        }

        /* Â∑¶‰æßËÆ∞ÂΩïÁöÑÊòüÊòüÔºöÂú®Âè≥ËæπÁºòÔºàÈù†ËøëÊó∂Èó¥ËΩ¥Ôºâ */
        .timeline-item.left.miracle::before,
        .timeline-item.miracle.left::before,
        .timeline-item[class*="left"].miracle::before,
        .timeline-item.miracle[class*="left"]::before {
            right: -15px !important;
            left: auto !important;
        }

        /* Âè≥‰æßËÆ∞ÂΩïÁöÑÊòüÊòüÔºöÂú®Â∑¶ËæπÁºòÔºàÈù†ËøëÊó∂Èó¥ËΩ¥Ôºâ */
        .timeline-item.right.miracle::before,
        .timeline-item.miracle.right::before,
        .timeline-item[class*="right"].miracle::before,
        .timeline-item.miracle[class*="right"]::before {
            left: -15px !important;
            right: auto !important;
        }

        /* Á°Æ‰øùÂú®timeline-row‰∏≠‰πüËÉΩÊ≠£Á°ÆÊòæÁ§∫ */
        .timeline-row .timeline-item.left.miracle::before,
        .timeline-row .timeline-item.miracle.left::before,
        .timeline-row .timeline-item[class*="left"].miracle::before,
        .timeline-row .timeline-item.miracle[class*="left"]::before {
            right: -15px !important;
            left: auto !important;
        }

        .timeline-row .timeline-item.right.miracle::before,
        .timeline-row .timeline-item.miracle.right::before,
        .timeline-row .timeline-item[class*="right"].miracle::before,
        .timeline-row .timeline-item.miracle[class*="right"]::before {
            left: -15px !important;
            right: auto !important;
        }

        .item-time {
            font-size: 12px;
            color: #6366F1;
            margin-bottom: 10px;
            font-weight: 500;
            opacity: 0.7;
        }

        .item-type {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #1D1D1F;
        }

        .item-text {
            font-size: 15px;
            color: #4B5563;
            line-height: 1.6;
        }

        .question-pair {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #8B5CF6;
            border-radius: 8px;
            background-color: rgba(139, 92, 246, 0.02);
        }

        .question-pair-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
            color: #8B5CF6;
        }

        .answer-pair {
            display: flex;
            gap: 20px;
        }

        .answer-box {
            flex: 1;
            padding: 15px;
            border: 1px solid #C4B5FD;
            border-radius: 4px;
            background-color: #ffffff;
        }

        .answer-label {
            font-size: 12px;
            color: #A855F7;
            margin-bottom: 8px;
        }

        .answer-content {
            font-size: 14px;
            color: #6B46C1;
            line-height: 1.6;
            min-height: 40px;
        }

        .question-diary {
            margin-bottom: 32px;
            padding: 28px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
        }

        .question-diary-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 24px;
            color: #1D1D1F;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .diary-entry {
            margin-bottom: 16px;
            padding: 18px;
            background: rgba(255, 255, 255, 0.9);
            border-left: 3px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
        }

        .diary-entry:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .diary-date {
            font-size: 12px;
            color: #6366F1;
            margin-bottom: 10px;
            font-weight: 500;
            opacity: 0.7;
        }

        .diary-content {
            font-size: 15px;
            color: #4B5563;
            line-height: 1.8;
        }

        .diary-entry-pair {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .diary-entry-single {
            flex: 1;
        }

        .diary-columns {
            display: flex;
            gap: 15px;
        }

        .diary-column {
            flex: 1;
        }

        .review-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
        }

        .action-btn {
            padding: 14px 32px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            color: #6366F1;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1);
        }

        .action-btn:hover {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.2);
        }

        .empty-message {
            text-align: center;
            padding: 48px;
            color: #9CA3AF;
            font-size: 16px;
            font-weight: 400;
        }

        /* ÂºπÁ™óÊ†∑Âºè */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            padding: 40px;
            border-radius: 24px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }

        .modal-title {
            font-size: 22px;
            margin-bottom: 24px;
            color: #1D1D1F;
            font-weight: 600;
            letter-spacing: -0.3px;
        }

        .modal-btn {
            padding: 14px 32px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            color: #6366F1;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1);
        }

        .modal-btn:hover {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.2);
        }

        @media print {
            .review-actions {
                display: none;
            }
            .action-btn {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- È¶ñÈ°µ -->
    <div id="homePage" class="page active">
        <div class="home-page">
            <div class="heart-icon">‚ù§Ô∏è</div>
            <div id="titleGreeting" class="title-greeting">Ê†áÈ¢òÂØÑËØ≠</div>
            <div id="clock" class="clock">00:00:00</div>
            
            <div class="buttons-container">
                <div class="button-row">
                    <button class="emotion-btn" data-type="ÊÉ≥Âøµ‰Ω†">ÊÉ≥Âøµ‰Ω†</button>
                    <input type="text" class="text-input" data-type="ÊÉ≥Âøµ‰Ω†" placeholder="ÊÉ≥ËØ¥‰∫õ‰ªÄ‰πà...">
                    <button class="submit-btn" data-type="ÊÉ≥Âøµ‰Ω†">Êèê‰∫§</button>
                </div>
                <div class="button-row">
                    <button class="emotion-btn" data-type="Ë∞¢Ë∞¢‰Ω†">Ë∞¢Ë∞¢‰Ω†</button>
                    <input type="text" class="text-input" data-type="Ë∞¢Ë∞¢‰Ω†" placeholder="ÊÉ≥ËØ¥‰∫õ‰ªÄ‰πà...">
                    <button class="submit-btn" data-type="Ë∞¢Ë∞¢‰Ω†">Êèê‰∫§</button>
                </div>
                <div class="button-row">
                    <button class="emotion-btn" data-type="ÂØπ‰∏çËµ∑">ÂØπ‰∏çËµ∑</button>
                    <input type="text" class="text-input" data-type="ÂØπ‰∏çËµ∑" placeholder="ÊÉ≥ËØ¥‰∫õ‰ªÄ‰πà...">
                    <button class="submit-btn" data-type="ÂØπ‰∏çËµ∑">Êèê‰∫§</button>
                </div>
                <div class="button-row">
                    <button class="emotion-btn" data-type="ËØ∑ÂéüË∞Ö">ËØ∑ÂéüË∞Ö</button>
                    <input type="text" class="text-input" data-type="ËØ∑ÂéüË∞Ö" placeholder="ÊÉ≥ËØ¥‰∫õ‰ªÄ‰πà...">
                    <button class="submit-btn" data-type="ËØ∑ÂéüË∞Ö">Êèê‰∫§</button>
                </div>
                <div class="button-row">
                    <button class="emotion-btn" data-type="ÊàëÁà±‰Ω†">ÊàëÁà±‰Ω†</button>
                    <input type="text" class="text-input" data-type="ÊàëÁà±‰Ω†" placeholder="ÊÉ≥ËØ¥‰∫õ‰ªÄ‰πà...">
                    <button class="submit-btn" data-type="ÊàëÁà±‰Ω†">Êèê‰∫§</button>
                </div>
            </div>

            <div class="question-section">
                <div class="question-header">
                    <div class="question-text" id="questionText">ÈóÆÈ¢ò1</div>
                    <button class="refresh-btn" id="refreshQuestionBtn">Âà∑Êñ∞ÈóÆÈ¢ò</button>
                </div>
                <textarea class="answer-input" id="answerInput" placeholder="ÂÜô‰∏ã‰Ω†ÁöÑÂõûÁ≠î..."></textarea>
                <div class="question-submit-container">
                    <button class="question-submit-btn" id="questionSubmitBtn">Êèê‰∫§ÂõûÁ≠î</button>
                </div>
            </div>

            <div class="share-section">
                <button class="share-btn" id="shareBtn">ÂàÜ‰∫´</button>
                <button class="clear-btn" id="clearBtn">Ê∏ÖÁêÜÊï∞ÊçÆ</button>
                <div class="share-input-container">
                    <input type="text" class="share-input" id="shareInput" placeholder="Á≤òË¥¥ÂàÜ‰∫´ÈìæÊé•ÔºåÊü•ÁúãÂ§çÁõòÈ°µÈù¢...">
                    <button class="load-btn" id="loadBtn">Âä†ËΩΩÂ§çÁõò</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Â§çÁõòÈ°µÈù¢ -->
    <div id="reviewPage" class="page">
        <div class="review-page">
            <div class="review-header">ÊÄùÂøµÂ§çÁõò</div>
            
            <div class="review-container">
                <div class="review-header-section">
                    <div class="column-title" id="leftColumnTitle">ÂØπÊñπÁöÑËÆ∞ÂΩï</div>
                    <div class="column-title" id="rightColumnTitle">ÊàëÁöÑËÆ∞ÂΩï</div>
                </div>
                <div id="unifiedTimeline" class="timeline">
                    <div class="timeline-line"></div>
                </div>
            </div>

            <div id="questionPairs"></div>

            <div class="review-actions">
                <button class="action-btn" id="exportBtn">ÂØºÂá∫PDF</button>
                <button class="action-btn" id="exitBtn">ÈÄÄÂá∫</button>
            </div>
        </div>
    </div>

    <!-- ÂºπÁ™ó -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">Êú¨Âë®Â§çÁõòÊó∂Èó¥Â∑≤Âà∞</div>
            <button class="modal-btn" id="modalCloseBtn">Áü•ÈÅì‰∫Ü</button>
        </div>
    </div>

    <script>
        // Êï∞ÊçÆÂ≠òÂÇ®ÈîÆÂêç
        const STORAGE_KEY = 'missingsContainer';
        const QUESTION_STORAGE_KEY = 'missingsContainerQuestions';

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initTitleGreeting();
            initClock();
            initButtons();
            initQuestion();
            initShare();
            initReview();
            checkWeeklyReset();
            checkReviewReminder();
            checkURLParams();
        });

        // Ê†áÈ¢òÂØÑËØ≠ÂàùÂßãÂåñ
        function initTitleGreeting() {
            const greetings = [
                '‰∏áÁâ©ÊµÅËΩ¨ÔºåÂîØÊúâÊ≠§Êó∂Ê≠§ÂàªÔºåÂ±û‰∫éÊàë‰ª¨',
                'ÁúãÔºåËøôÊòØÊú¨Âë®Êàë‰ª¨‰∫§Êç¢ËøáÁöÑÂÖâÈò¥',
                'Ëøô‰∏ÄÂë®ÔºåÊàë‰ª¨Â∑≤Âú®ÂΩºÊ≠§ÁöÑÁîüÂëΩÈáåÔºåÂÅúÁïô‰∫ÜËøô‰πà‰πÖ',
                'Êú¨Âë®Áõ∏‰º¥ËøõÂ∫¶‚¨áÔ∏è',
                'Êàë‰ª¨Âú®ÂÆáÂÆô‰∏≠Â≠òÂú®‰∫Ü‰∏ÄÂë®ÁöÑËØÅÊçÆ',
                '‰∏ÄÂë®ÁªìÊùüÂêéÔºå‰∏ÄËµ∑ÂàõÈÄ†ÈáçÈÄ¢ÁöÑÂ•áËøπ'
            ];
            
            // Ëé∑ÂèñÂΩìÂâçÊòæÁ§∫ÁöÑÁ¥¢ÂºïÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàô‰ªé0ÂºÄÂßã
            const GREETING_INDEX_KEY = 'titleGreetingIndex';
            let currentIndex = parseInt(localStorage.getItem(GREETING_INDEX_KEY)) || 0;
            
            // ÊòæÁ§∫ÂΩìÂâçÂè•Â≠ê
            const greetingEl = document.getElementById('titleGreeting');
            greetingEl.textContent = greetings[currentIndex];
            
            // Êõ¥Êñ∞Á¥¢ÂºïÔºå‰∏ãÊ¨°Âà∑Êñ∞Êó∂ÊòæÁ§∫‰∏ã‰∏Ä‰∏™
            currentIndex = (currentIndex + 1) % greetings.length;
            localStorage.setItem(GREETING_INDEX_KEY, currentIndex.toString());
        }

        // Êó∂ÈíüÊõ¥Êñ∞
        function initClock() {
            const clockEl = document.getElementById('clock');
            function updateClock() {
                // Ëé∑ÂèñÂåó‰∫¨Êó∂Èó¥ÔºàUTC+8Ôºâ
                const now = new Date();
                const utcTime = now.getTime() + (now.getTimezoneOffset() * 60 * 1000);
                const beijingTime = new Date(utcTime + (8 * 60 * 60 * 1000));
                
                // ËÆ°ÁÆóÊú¨Âë®‰∏ÄÂºÄÂßãÁöÑÊó∂Èó¥ÔºàÂë®‰∏Ä00:00:00Ôºâ
                const dayOfWeek = beijingTime.getDay(); // 0=Âë®Êó•, 1=Âë®‰∏Ä, ..., 6=Âë®ÂÖ≠
                const daysFromMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Âë®Êó•ÁÆó‰Ωú‰∏äÂë®ÁöÑÊúÄÂêé‰∏ÄÂ§©
                
                const mondayStart = new Date(beijingTime);
                mondayStart.setDate(beijingTime.getDate() - daysFromMonday);
                mondayStart.setHours(0, 0, 0, 0);
                
                // ËÆ°ÁÆó‰ªéÊú¨Âë®‰∏ÄÂºÄÂßãÂà∞Áé∞Âú®ÁªèËøáÁöÑÊÄªÊØ´ÁßíÊï∞
                const elapsedMs = beijingTime.getTime() - mondayStart.getTime();
                
                // ËΩ¨Êç¢‰∏∫Êó∂ÂàÜÁßí
                const totalSeconds = Math.floor(elapsedMs / 1000);
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;
                
                // Ê†ºÂºèÂåñ‰∏∫Êó∂ÂàÜÁßíÔºå‰ΩøÁî®Á≠âÂÆΩÊï∞Â≠óÁ°Æ‰øù‰ΩçÁΩÆÂõ∫ÂÆö
                const hoursStr = String(hours).padStart(2, '0');
                const minutesStr = String(minutes).padStart(2, '0');
                const secondsStr = String(seconds).padStart(2, '0');
                
                clockEl.textContent = `${hoursStr}:${minutesStr}:${secondsStr}`;
            }
            updateClock();
            setInterval(updateClock, 1000);
        }

        // ÊåâÈíÆ‰∫ã‰ª∂
        function initButtons() {
            // ÊÉÖÊÑüÊåâÈíÆ‰∫ã‰ª∂
            const buttons = document.querySelectorAll('.emotion-btn');
            buttons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    const input = document.querySelector(`.text-input[data-type="${type}"]`);
                    const text = input.value.trim();
                    
                    if (text) {
                        saveRecord(type, text, this);
                        input.value = '';
                    } else {
                        saveRecord(type, '', this);
                    }
                });
            });

            // Êèê‰∫§ÊåâÈíÆ‰∫ã‰ª∂
            const submitButtons = document.querySelectorAll('.submit-btn');
            submitButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    const input = document.querySelector(`.text-input[data-type="${type}"]`);
                    const text = input.value.trim();
                    
                    if (text) {
                        saveRecord(type, text, this);
                        input.value = ''; // Êèê‰∫§ÂêéÊ∏ÖÁ©∫ÊñáÊú¨Ê°Ü
                        // ÁÆÄÂçïÁöÑÊèê‰∫§ÂèçÈ¶à
                        this.textContent = 'Â∑≤Êèê‰∫§';
                        this.style.backgroundColor = '#8B5CF6';
                        this.style.color = '#ffffff';
                        setTimeout(() => {
                            this.textContent = 'Êèê‰∫§';
                            this.style.backgroundColor = 'transparent';
                            this.style.color = '#8B5CF6';
                        }, 1000);
                    } else {
                        alert('ËØ∑ËæìÂÖ•ÂÜÖÂÆπÂêéÂÜçÊèê‰∫§');
                    }
                });
            });

            // ÊñáÊú¨Ê°ÜÂõûËΩ¶Êèê‰∫§
            const textInputs = document.querySelectorAll('.text-input');
            textInputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const type = this.getAttribute('data-type');
                        const submitBtn = document.querySelector(`.submit-btn[data-type="${type}"]`);
                        submitBtn.click();
                    }
                });
            });
        }

        // Èò≤ÊäñËÆ°Êó∂Âô®ÔºöÂ≠òÂÇ®ÊØè‰∏™ÊåâÈíÆÁ±ªÂûãÁöÑÊúÄÂêéÁÇπÂáªÊó∂Èó¥
        const buttonDebounceTimers = {};

        // ÊåâÈíÆÁ±ªÂûãÂØπÂ∫îÁöÑemojiÊò†Â∞Ñ
        const buttonEmojiMap = {
            'ÊÉ≥Âøµ‰Ω†': 'üíï',
            'Ë∞¢Ë∞¢‰Ω†': '‚ò∫Ô∏è',
            'ÂØπ‰∏çËµ∑': 'üòî',
            'ËØ∑ÂéüË∞Ö': 'üôá',
            'ÊàëÁà±‰Ω†': '‚ù§Ô∏è',
            'question': '‚ú®'
        };

        // ÊòæÁ§∫emojiÂä®Áîª
        function showPlusOne(button, emoji) {
            const plusOne = document.createElement('div');
            plusOne.className = 'plus-one';
            plusOne.textContent = emoji || '‚ú®';
            
            // Ëé∑ÂèñÊåâÈíÆ‰ΩçÁΩÆ
            const rect = button.getBoundingClientRect();
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
            
            plusOne.style.left = (rect.left + rect.width / 2 - 15 + scrollLeft) + 'px';
            plusOne.style.top = (rect.top - 10 + scrollTop) + 'px';
            
            document.body.appendChild(plusOne);
            
            // Âä®ÁîªÁªìÊùüÂêéÁßªÈô§ÂÖÉÁ¥†
            setTimeout(() => {
                if (plusOne.parentNode) {
                    plusOne.parentNode.removeChild(plusOne);
                }
            }, 1000);
        }

        // ‰øùÂ≠òËÆ∞ÂΩïÔºàÂ∏¶Èò≤ÊäñÔºâ
        function saveRecord(type, text, button) {
            const now = Date.now();
            const lastClickTime = buttonDebounceTimers[type] || 0;
            const DEBOUNCE_TIME = 10000; // 10Áßí
            const textIsEmpty = !text || text.trim() === '';
            
            // ÊòæÁ§∫emojiÂä®Áîª
            if (button) {
                const emoji = buttonEmojiMap[type] || '‚ú®';
                showPlusOne(button, emoji);
            }
            
            // Â¶ÇÊûúÊñáÊú¨‰∏∫Á©∫Ôºå10ÁßíÂÜÖÂ§öÊ¨°ÁÇπÂáªÔºåÂè™ËÆ∞ÂΩïÊúÄÂêé‰∏ÄÊ¨°
            if (textIsEmpty && now - lastClickTime < DEBOUNCE_TIME && lastClickTime > 0) {
                const records = getRecords();
                // ÊâæÂà∞ÊúÄÂêé‰∏ÄÊù°ÔºàÊó∂Èó¥Êà≥ÊúÄÂ§ßÁöÑÔºâÁõ∏ÂêåÁ±ªÂûã‰∏îÊñáÊú¨‰πü‰∏∫Á©∫ÁöÑËÆ∞ÂΩï
                let lastRecordIndex = -1;
                let maxTimestamp = 0;
                
                for (let i = 0; i < records.length; i++) {
                    const record = records[i];
                    const recordTextIsEmpty = !record.text || record.text.trim() === '';
                    if (record.type === type && recordTextIsEmpty && record.timestamp > maxTimestamp) {
                        maxTimestamp = record.timestamp;
                        lastRecordIndex = i;
                    }
                }
                
                // Â¶ÇÊûúÊâæÂà∞‰∫ÜËÆ∞ÂΩï‰∏îÂú®10ÁßíÂÜÖÔºåÊõ¥Êñ∞ÂÆÉ
                if (lastRecordIndex >= 0 && (now - maxTimestamp) < DEBOUNCE_TIME) {
                    records[lastRecordIndex].timestamp = now;
                    records[lastRecordIndex].text = text;
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
                    buttonDebounceTimers[type] = now;
                    return;
                }
            }
            
            // Â¶ÇÊûúÊñáÊú¨ÊúâÂÜÖÂÆπÔºåÊØèÊ¨°Êèê‰∫§ÈÉΩË¶ÅËÆ∞ÂΩïÔºå‰∏çÂèØË¶ÜÁõñÔºàÊÄªÊòØÊñ∞Â¢ûËÆ∞ÂΩïÔºâ
            // Ê≠£Â∏∏Ê∑ªÂä†Êñ∞ËÆ∞ÂΩï
            const records = getRecords();
            records.push({
                timestamp: now,
                type: type,
                text: text
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
            buttonDebounceTimers[type] = now;
        }

        // Ëé∑ÂèñËÆ∞ÂΩï
        function getRecords() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : [];
        }

        // ÂΩìÂâçÈóÆÈ¢òÁ¥¢Âºï
        let currentQuestionIndex = 0;
        const questions = [
            'Êú¨Âë®ÂíåÂØπÊñπÁõ∏Â§ÑÊó∂ÔºåÊúÄËÆ©Êàë"ÂæóÂÖ∂ÊÑèÂøòÂΩ¢"Êàñ"ÈÅáËßÅÂ•áËøπ"ÁöÑÁû¨Èó¥ÊòØ‰ªÄ‰πàÔºüÔºàÊó†ÈúÄÂàªÊÑèÁöÑÊùæÂºõ‰∏éÊÑâÊÇ¶„ÄÅÊÑøÊúõ‰ª•ÊÑèÊÉ≥‰∏çÂà∞ÁöÑÂΩ¢ÂºèÂá∫Áé∞Ôºâ',
            'ÂØπÊñπÁöÑÂì™‰∏™Â∞è‰∏æÂä®ËÆ©ÊàëÊÑüÂèóÂà∞"Ë¢´ÁúãËßÅ"Ôºü',
            'ÊàëÊòØÂê¶Áî®"Â∫îËØ•"ÁªëÊû∂‰∫ÜÂØπÊñπÔºüÊç¢Êàê"ÂÄºÂæó"ÁöÑË°®Ëø∞ÊòØ______„ÄÇ',
            'ÊàëËÆ§‰∏∫ÔºåÂØπÊñπÂú®ÂÖ≥Á≥ªÈáåÁöÑ"ËÆ§Áü•Áõ≤Âå∫"ÊòØ‰ªÄ‰πàÔºüÔºàÂ¶ÇÂøΩÁï•ÂØπÊñπÊÉÖÁª™„ÄÅËøáÂ∫¶Ëá™ÊàëÔºâÔºåÂ¶Ç‰ΩïÈÄöËøáÊ≤üÈÄöÂ°´Ë°•Ôºü',
            'Êú¨Âë®ÊúÄÊÑüÊÅ©ÂØπÊñπÁöÑ‰∏ÄÁÇπÊòØ______ÔºåÊÑüÊÅ©Ëá™Â∑±ÁöÑ‰∏ÄÁÇπÊòØ______„ÄÇ',
            'Áî®‰∏ÄÂè•"ÂííËØ≠"ÂΩ¢ÂÆπÊú¨Âë®ÂÖ≥Á≥ªÁä∂ÊÄÅÔºö______„ÄÇ',
            'ÊàëÊÉ≥‰∏∫ÂØπÊñπÂÅöÁöÑ"ÊöñÂøÉÂ∞è‰∫ã"ÊòØ______Ôºå‰∏çÊ±ÇÂõûÊä•‰ΩÜÊ±ÇÁúüÂøÉ„ÄÇ',
            'ÊàëÂ∏åÊúõÂØπÊñπÊîØÊåÅÊàë______ÔºåÊàë‰ºöÁî®______ÊñπÂºèÊ∏ÖÊô∞Ë°®Ëææ„ÄÇ',
            'Ëã•ÈÅáÂà∞ÁüõÁõæÔºåÊàë‰ª¨Á∫¶ÂÆöÁöÑ"ÂÜ∑ÈùôÊ≤üÈÄöÂè•Âºè"ÊòØ______ÔºàÂ¶Ç"ÊàëËØ¥ËØ¥ÊàëÁöÑÊÑüÂèóÔºå‰Ω†Âê¨Âê¨Â∞±Â•Ω"Ôºâ„ÄÇ',
            'ÊàëÂáÜÂ§áÊîæ‰∏ãÁöÑ"ÂÖ≥Á≥ªÂÜÖËÄó"ÊòØ______ÔºàÂ¶ÇËøáÂ∫¶ÊïèÊÑü„ÄÅËøáÂæÄÂøÉÁªìÔºâ„ÄÇ',
            '‰∏ãÂë®ÊÉ≥ÂíåÂØπÊñπÊé¢Á¥¢ÁöÑ"Êñ∞Âú∫ÊôØ"ÊòØ______„ÄÇ',
            'Êàë‰ºöÈÄöËøá______ËÆ©ÂØπÊñπÊÑüÂèóÂà∞"Ë¢´‰ø°‰ªª"„ÄÇ',
            'Êú¨Âë®ÂÖ≥Á≥ªÂÖ≥ÈîÆËØçÔºö______„ÄÇ'
        ];

        // ÈóÆÈ¢òÂàùÂßãÂåñ
        function initQuestion() {
            // ÈöèÊú∫ÈÄâÊã©ÂàùÂßãÈóÆÈ¢ò
            currentQuestionIndex = Math.floor(Math.random() * questions.length);
            const currentQuestion = questions[currentQuestionIndex];
            document.getElementById('questionText').textContent = currentQuestion;
            
            // Âà∑Êñ∞Êó∂ÊñáÊú¨Ê°Ü‰∏∫Á©∫Ôºå‰∏çÂä†ËΩΩ‰πãÂâç‰øùÂ≠òÁöÑÂõûÁ≠î
            document.getElementById('answerInput').value = '';

            // Âà∑Êñ∞ÈóÆÈ¢òÊåâÈíÆ‰∫ã‰ª∂
            document.getElementById('refreshQuestionBtn').addEventListener('click', function() {
                // ÂàáÊç¢Âà∞‰∏ã‰∏Ä‰∏™ÈóÆÈ¢ò
                currentQuestionIndex = (currentQuestionIndex + 1) % questions.length;
                const newQuestion = questions[currentQuestionIndex];
                document.getElementById('questionText').textContent = newQuestion;
                
                // ÂàáÊç¢ÈóÆÈ¢òÊó∂ÊñáÊú¨Ê°Ü‰πü‰∏∫Á©∫
                document.getElementById('answerInput').value = '';
            });

            // Êèê‰∫§ÂõûÁ≠îÊåâÈíÆ‰∫ã‰ª∂
            document.getElementById('questionSubmitBtn').addEventListener('click', function() {
                const answerInput = document.getElementById('answerInput');
                const answer = answerInput.value.trim();
                
                if (!answer) {
                    alert('ËØ∑ËæìÂÖ•ÂõûÁ≠îÂêéÂÜçÊèê‰∫§');
                    return;
                }
                
                const currentQuestion = document.getElementById('questionText').textContent;
                saveQuestionData(currentQuestion, answer);
                
                // Êèê‰∫§ÂêéÊ∏ÖÁ©∫ÊñáÊú¨Ê°Ü
                answerInput.value = '';
                
                // ÊòæÁ§∫emojiÂä®Áîª
                showPlusOne(this, buttonEmojiMap['question']);
                
                // Êèê‰∫§ÂèçÈ¶à
                this.textContent = 'Â∑≤Êèê‰∫§';
                this.style.backgroundColor = '#8B5CF6';
                this.style.color = '#ffffff';
                setTimeout(() => {
                    this.textContent = 'Êèê‰∫§ÂõûÁ≠î';
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#8B5CF6';
                }, 1000);
            });
        }

        // ‰øùÂ≠òÈóÆÈ¢òÊï∞ÊçÆÔºàÊï∞ÁªÑÂΩ¢ÂºèÔºå‰∏çË¶ÜÁõñÔºâ
        function saveQuestionData(question, answer) {
            // Ëé∑ÂèñÊâÄÊúâÂ∑≤‰øùÂ≠òÁöÑÈóÆÈ¢òÂõûÁ≠î
            const allData = getAllQuestionData();
            // Â¶ÇÊûúËØ•ÈóÆÈ¢òËøòÊ≤°ÊúâËÆ∞ÂΩïÔºåÂàùÂßãÂåñ‰∏∫Êï∞ÁªÑ
            if (!allData[question]) {
                allData[question] = [];
            }
            // Ê∑ªÂä†Êñ∞ÂõûÁ≠îÔºà‰∏çË¶ÜÁõñ‰πãÂâçÁöÑÔºâ
            allData[question].push({
                answer: answer,
                timestamp: Date.now()
            });
            // ÊåâÊó∂Èó¥ÊéíÂ∫è
            allData[question].sort((a, b) => a.timestamp - b.timestamp);
            localStorage.setItem(QUESTION_STORAGE_KEY, JSON.stringify(allData));
        }

        // Ëé∑ÂèñÊâÄÊúâÈóÆÈ¢òÊï∞ÊçÆ
        function getAllQuestionData() {
            const data = localStorage.getItem(QUESTION_STORAGE_KEY);
            if (!data) return {};
            
            const parsed = JSON.parse(data);
            // ÂÖºÂÆπÊóßÊ†ºÂºèÔºöÂ¶ÇÊûúÊòØÂØπË±°‰∏î‰∏çÊòØÊï∞ÁªÑÔºåËΩ¨Êç¢‰∏∫Êñ∞Ê†ºÂºè
            const result = {};
            for (const key in parsed) {
                if (Array.isArray(parsed[key])) {
                    result[key] = parsed[key];
                } else if (parsed[key].answer !== undefined) {
                    // ÊóßÊ†ºÂºèÔºöÂçï‰∏™ÂØπË±°ÔºåËΩ¨Êç¢‰∏∫Êï∞ÁªÑ
                    result[key] = [parsed[key]];
                } else {
                    result[key] = [];
                }
            }
            return result;
        }

        // Ëé∑ÂèñÈóÆÈ¢òÊï∞ÊçÆÔºàÂÖºÂÆπÊóßÊ†ºÂºèÔºåÁî®‰∫éÂ§çÁõòÈ°µÈù¢Ôºâ
        function getQuestionData() {
            // Ëøô‰∏™ÂáΩÊï∞‰∏ªË¶ÅÁî®‰∫éÂÖºÂÆπÂ§çÁõòÈ°µÈù¢ÁöÑÊóßÈÄªËæë
            // Áé∞Âú®Â§çÁõòÈ°µÈù¢Áõ¥Êé•‰ΩøÁî®getAllQuestionData()ÔºåÊâÄ‰ª•Ëøô‰∏™ÂáΩÊï∞ÂèØ‰ª•ËøîÂõûÁ©∫ÂØπË±°
            return { question: '', answer: '' };
        }

        // ÂàÜ‰∫´ÂäüËÉΩ
        function initShare() {
            document.getElementById('shareBtn').addEventListener('click', function() {
                // ÂºπÂá∫ÊòµÁß∞ËæìÂÖ•Ê°Ü
                const nickname = prompt('‰Ω†Â∏åÊúõÂØπÊñπÁúãÂà∞ÁöÑÊòµÁß∞ÊòØÔºà10‰∏™Â≠óÁ¨¶‰ª•ÂÜÖÔºâ', '');
                
                if (nickname === null) {
                    // Áî®Êà∑ÂèñÊ∂à‰∫ÜËæìÂÖ•
                    return;
                }
                
                // È™åËØÅÊòµÁß∞ÈïøÂ∫¶
                const trimmedNickname = nickname.trim();
                if (trimmedNickname.length === 0) {
                    alert('ÊòµÁß∞‰∏çËÉΩ‰∏∫Á©∫');
                    return;
                }
                
                if (trimmedNickname.length > 10) {
                    alert('ÊòµÁß∞‰∏çËÉΩË∂ÖËøá10‰∏™Â≠óÁ¨¶');
                    return;
                }
                
                const records = getRecords();
                const allQuestionData = getAllQuestionData();
                
                const dataToShare = {
                    records: records,
                    questions: allQuestionData,
                    nickname: trimmedNickname
                };
                
                try {
                    const jsonStr = JSON.stringify(dataToShare);
                    const base64 = btoa(encodeURIComponent(jsonStr));
                    // ‰ΩøÁî®Âä®ÊÄÅË∑ØÂæÑÁîüÊàêÂàÜ‰∫´ÈìæÊé•ÔºåÂÖºÂÆπGitHub PagesÁ≠âÈÉ®ÁΩ≤ÁéØÂ¢É
                    // window.location.origin: ÂçèËÆÆ+ÂüüÂêç+Á´ØÂè£ (Â¶Ç https://username.github.io)
                    // window.location.pathname: Ë∑ØÂæÑÈÉ®ÂàÜ (Â¶Ç /repository-name/index.html Êàñ /index.html)
                    // ËøôÊ†∑ÁîüÊàêÁöÑÈìæÊé•ÂèØ‰ª•Âú®‰ªª‰ΩïÈÉ®ÁΩ≤ÁéØÂ¢É‰∏ãÊ≠£Â∏∏Â∑•‰Ωú
                    const url = window.location.origin + window.location.pathname + '?data=' + base64;
                    
                    navigator.clipboard.writeText(url).then(() => {
                        alert('ÂàÜ‰∫´ÈìæÊé•Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
                    }).catch(() => {
                        // ÈôçÁ∫ßÊñπÊ°à
                        const textarea = document.createElement('textarea');
                        textarea.value = url;
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                        alert('ÂàÜ‰∫´ÈìæÊé•Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
                    });
                } catch (error) {
                    alert('ÂàÜ‰∫´Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
                }
            });

            // Âä†ËΩΩÂ§çÁõòÈ°µÈù¢ÊåâÈíÆ
            document.getElementById('loadBtn').addEventListener('click', function() {
                const shareInput = document.getElementById('shareInput');
                const url = shareInput.value.trim();
                
                if (!url) {
                    alert('ËØ∑ËæìÂÖ•ÂàÜ‰∫´ÈìæÊé•');
                    return;
                }
                
                // Ëß£ÊûêURL‰∏≠ÁöÑdataÂèÇÊï∞
                try {
                    let dataParam = '';
                    if (url.includes('?data=')) {
                        // ÂÆåÊï¥URLÊ†ºÂºè
                        const urlObj = new URL(url);
                        dataParam = urlObj.searchParams.get('data');
                    } else if (url.startsWith('data=')) {
                        // Âè™ÊúâdataÂèÇÊï∞
                        dataParam = url.substring(5);
                    } else {
                        // Â∞ùËØïÁõ¥Êé•‰Ωú‰∏∫base64Ëß£Á†Å
                        dataParam = url;
                    }
                    
                    if (!dataParam) {
                        alert('Êó†ÊïàÁöÑÂàÜ‰∫´ÈìæÊé•Ê†ºÂºè');
                        return;
                    }
                    
                    const jsonStr = decodeURIComponent(atob(dataParam));
                    const sharedData = JSON.parse(jsonStr);
                    
                    // Ë∑≥ËΩ¨Âà∞Â§çÁõòÈ°µÈù¢
                    initReviewButtons();
                    showReviewPage(sharedData);
                    
                    // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
                    shareInput.value = '';
                } catch (error) {
                    console.error('Êï∞ÊçÆËß£ÊûêÂ§±Ë¥•:', error);
                    alert('ÂàÜ‰∫´ÈìæÊé•Ê†ºÂºèÈîôËØØÔºåÊó†Ê≥ïÂä†ËΩΩ„ÄÇËØ∑Ê£ÄÊü•ÈìæÊé•ÊòØÂê¶Ê≠£Á°Æ„ÄÇ');
                }
            });

            // ËæìÂÖ•Ê°ÜÂõûËΩ¶ÈîÆÊèê‰∫§
            document.getElementById('shareInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('loadBtn').click();
                }
            });

            // Ê∏ÖÁêÜÊï∞ÊçÆÊåâÈíÆ
            document.getElementById('clearBtn').addEventListener('click', function() {
                // Á°ÆËÆ§ÂØπËØùÊ°Ü
                if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ÊâÄÊúâÊï∞ÊçÆÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ')) {
                    // Ê∏ÖÈô§ÊâÄÊúâlocalStorageÊï∞ÊçÆ
                    localStorage.removeItem(STORAGE_KEY);
                    localStorage.removeItem(QUESTION_STORAGE_KEY);
                    localStorage.removeItem('lastResetDate');
                    
                    // Ê∏ÖÁ©∫ÊâÄÊúâÈò≤ÊäñËÆ°Êó∂Âô®
                    for (const key in buttonDebounceTimers) {
                        delete buttonDebounceTimers[key];
                    }
                    
                    // Ê∏ÖÁ©∫È°µÈù¢‰∏äÁöÑËæìÂÖ•Ê°Ü
                    document.querySelectorAll('.text-input').forEach(input => {
                        input.value = '';
                    });
                    document.getElementById('answerInput').value = '';
                    
                    // ÊèêÁ§∫Áî®Êà∑
                    alert('ÊâÄÊúâÊï∞ÊçÆÂ∑≤Ê∏ÖÈô§ÔºÅ');
                    
                    // Âà∑Êñ∞È°µÈù¢‰ª•ÈáçÁΩÆÁä∂ÊÄÅ
                    location.reload();
                }
            });
        }

        // Ê£ÄÊü•URLÂèÇÊï∞
        function checkURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('data');
            
            if (dataParam) {
                try {
                    const jsonStr = decodeURIComponent(atob(dataParam));
                    const sharedData = JSON.parse(jsonStr);
                    initReviewButtons();
                    showReviewPage(sharedData);
                } catch (error) {
                    console.error('Êï∞ÊçÆËß£ÊûêÂ§±Ë¥•:', error);
                    alert('Êï∞ÊçÆÊ†ºÂºèÈîôËØØÔºåÊó†Ê≥ïÂä†ËΩΩ');
                }
            }
        }

        // ÊòæÁ§∫Â§çÁõòÈ°µÈù¢
        function showReviewPage(sharedData) {
            document.getElementById('homePage').classList.remove('active');
            document.getElementById('reviewPage').classList.add('active');
            
            // Ëé∑ÂèñÊòµÁß∞ÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàô‰ΩøÁî®ÈªòËÆ§ÂÄº
            const nickname = sharedData.nickname || 'ÂØπÊñπ';
            
            // Êõ¥Êñ∞Ê†áÈ¢ò
            document.getElementById('leftColumnTitle').textContent = nickname + 'ÁöÑËÆ∞ÂΩï';
            document.getElementById('rightColumnTitle').textContent = 'ÊàëÁöÑËÆ∞ÂΩï';
            
            // Â∑¶‰æßÊòæÁ§∫ÂàÜ‰∫´ËÄÖÁöÑËÆ∞ÂΩïÔºàÂ∏¶ÊòµÁß∞ÔºâÔºåÂè≥‰æßÊòæÁ§∫ÂΩìÂâçÊü•ÁúãËÄÖÁöÑËÆ∞ÂΩïÔºàÊàëÁöÑËÆ∞ÂΩïÔºâ
            // renderUnifiedTimeline ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞‰ºöÊ†áËÆ∞‰∏∫ source: 'my'Ôºå‰ΩÜÁî±‰∫é leftRecords/rightRecords Â∑≤‰∫§Êç¢ÔºåÂÆûÈôÖÊòæÁ§∫Âú®Âè≥Ëæπ
            // Á¨¨‰∫å‰∏™ÂèÇÊï∞‰ºöÊ†áËÆ∞‰∏∫ source: 'other'Ôºå‰ΩÜÁî±‰∫é leftRecords/rightRecords Â∑≤‰∫§Êç¢ÔºåÂÆûÈôÖÊòæÁ§∫Âú®Â∑¶Ëæπ
            const currentUserRecords = getRecords();  // ÂΩìÂâçÊü•ÁúãËÄÖÁöÑËÆ∞ÂΩïÔºåÂ∫îËØ•ÊòæÁ§∫Âú®Âè≥ËæπÔºàÊàëÁöÑËÆ∞ÂΩïÔºâ
            const sharedUserRecords = sharedData.records || [];  // ÂàÜ‰∫´ËÄÖÁöÑËÆ∞ÂΩïÔºåÂ∫îËØ•ÊòæÁ§∫Âú®Â∑¶ËæπÔºàÊòµÁß∞ÁöÑËÆ∞ÂΩïÔºâ
            const currentUserQuestions = getAllQuestionData();
            // ÂÖºÂÆπÊóßÊ†ºÂºèÔºàÂçï‰∏™ÈóÆÈ¢òÔºâÂíåÊñ∞Ê†ºÂºèÔºàÂ§ö‰∏™ÈóÆÈ¢òÔºâ
            const sharedUserQuestions = sharedData.questions || (sharedData.question ? { [sharedData.question.question]: { answer: sharedData.question.answer } } : {});
            
            // Â∑¶‰æßÊòæÁ§∫ÂàÜ‰∫´ËÄÖÁöÑËÆ∞ÂΩïÔºà[ÊòµÁß∞]ÁöÑËÆ∞ÂΩïÔºâÔºåÂè≥‰æßÊòæÁ§∫ÂΩìÂâçÊü•ÁúãËÄÖÁöÑËÆ∞ÂΩïÔºàÊàëÁöÑËÆ∞ÂΩïÔºâ
            // renderUnifiedTimeline ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞‰ºöÊ†áËÆ∞‰∏∫ source: 'my'ÔºåÁ¨¨‰∫å‰∏™ÂèÇÊï∞‰ºöÊ†áËÆ∞‰∏∫ source: 'other'
            // leftRecords = source: 'other' (ÂàÜ‰∫´ËÄÖ) -> Â∑¶Ëæπ
            // rightRecords = source: 'my' (ÂΩìÂâçÊü•ÁúãËÄÖ) -> Âè≥Ëæπ
            // ÊâÄ‰ª•ÔºöÂàÜ‰∫´ËÄÖ‰Ωú‰∏∫Á¨¨‰∫å‰∏™ÂèÇÊï∞Ôºàsource: 'other' -> Â∑¶ËæπÔºâÔºåÂΩìÂâçÊü•ÁúãËÄÖ‰Ωú‰∏∫Á¨¨‰∏Ä‰∏™ÂèÇÊï∞Ôºàsource: 'my' -> Âè≥ËæπÔºâ
            renderUnifiedTimeline(currentUserRecords, sharedUserRecords);
            renderQuestionPairs(currentUserQuestions, sharedUserQuestions, nickname);
        }

        // ÂàùÂßãÂåñÂ§çÁõòÈ°µÈù¢ÊåâÈíÆÔºàÂè™ÁªëÂÆö‰∏ÄÊ¨°Ôºâ
        function initReviewButtons() {
            // ÂØºÂá∫PDF
            const exportBtn = document.getElementById('exportBtn');
            const exitBtn = document.getElementById('exitBtn');
            
            // ÁßªÈô§ÊóßÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®ÔºàÈÄöËøáÂÖãÈöÜËäÇÁÇπÔºâ
            const newExportBtn = exportBtn.cloneNode(true);
            const newExitBtn = exitBtn.cloneNode(true);
            exportBtn.parentNode.replaceChild(newExportBtn, exportBtn);
            exitBtn.parentNode.replaceChild(newExitBtn, exitBtn);
            
            newExportBtn.addEventListener('click', function() {
                window.print();
            });
            
            newExitBtn.addEventListener('click', function() {
                window.history.replaceState({}, document.title, window.location.pathname);
                document.getElementById('reviewPage').classList.remove('active');
                document.getElementById('homePage').classList.add('active');
            });
        }

        // Ê∏≤ÊüìÁªü‰∏ÄÊó∂Èó¥ËΩ¥
        function renderUnifiedTimeline(myRecords, otherRecords) {
            const container = document.getElementById('unifiedTimeline');
            
            // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπÔºà‰øùÁïôÊó∂Èó¥ËΩ¥Á∫øÊù°Ôºâ
            const existingItems = container.querySelectorAll('.timeline-item, .empty-message');
            existingItems.forEach(item => item.remove());
            
            // Á°Æ‰øùÊó∂Èó¥ËΩ¥Á∫øÊù°Â≠òÂú®
            let timelineLine = container.querySelector('.timeline-line');
            if (!timelineLine) {
                timelineLine = document.createElement('div');
                timelineLine.className = 'timeline-line';
                container.appendChild(timelineLine);
            }
            
            // ÂêàÂπ∂ÊâÄÊúâËÆ∞ÂΩïÂπ∂Ê†áËÆ∞Êù•Ê∫ê
            const allRecords = [
                ...myRecords.map(r => ({ ...r, source: 'my' })),
                ...otherRecords.map(r => ({ ...r, source: 'other' }))
            ];
            
            if (allRecords.length === 0) {
                const emptyMsg = document.createElement('div');
                emptyMsg.className = 'empty-message';
                emptyMsg.textContent = 'ÊöÇÊó†ËÆ∞ÂΩï';
                container.appendChild(emptyMsg);
                return;
            }
            
            // ÊåâÊó∂Èó¥ÊéíÂ∫è
            const sortedRecords = allRecords.sort((a, b) => a.timestamp - b.timestamp);
            
            // Ê†áËÆ∞Â•áËøπËÆ∞ÂΩïÔºàÂü∫‰∫éÂéüÂßãËÆ∞ÂΩïÔºâ
            const miracleRecords = new Set();
            const MIRACLE_THRESHOLD = 10 * 60 * 1000; // 10ÂàÜÈíü
            
            myRecords.forEach(myRecord => {
                otherRecords.forEach(otherRecord => {
                    const timeDiff = Math.abs(myRecord.timestamp - otherRecord.timestamp);
                    if (timeDiff < MIRACLE_THRESHOLD) {
                        miracleRecords.add(myRecord.timestamp);
                        miracleRecords.add(otherRecord.timestamp);
                    }
                });
            });
            
            // ÂàõÂª∫Êó∂Èó¥Êà≥Âà∞ÂêàÂπ∂ËÆ∞ÂΩïÁöÑÊò†Â∞ÑÔºåÁî®‰∫éÂà§Êñ≠ÂêàÂπ∂ÂêéÁöÑËÆ∞ÂΩïÊòØÂê¶‰∏∫Â•áËøπ
            const timestampToMergedRecord = new Map();
            
            // Âà§Êñ≠ÂêàÂπ∂ÂêéÁöÑËÆ∞ÂΩïÊòØÂê¶‰∏∫Â•áËøπÔºàÊ£ÄÊü•ÂéüÂßãËÆ∞ÂΩï‰∏≠ÊòØÂê¶ÊúâÂ•áËøπÔºâ
            const isMergedRecordMiracle = (record) => {
                if (record.merged && record.originalRecords) {
                    return record.originalRecords.some(r => miracleRecords.has(r.timestamp));
                }
                return miracleRecords.has(record.timestamp);
            };
            
            // ÊåâÊó∂Èó¥ÂàÜÁªÑÔºå5ÂàÜÈíüÂÜÖÁöÑÂÜÖÂÆπËßÜ‰∏∫Âêå‰∏ÄÈ´òÂ∫¶
            const TIME_WINDOW = 5 * 60 * 1000; // 5ÂàÜÈíü
            const MINUTE_WINDOW = 60 * 1000; // 1ÂàÜÈíüÔºàÁî®‰∫éÂêàÂπ∂Âêå‰∏ÄÂàÜÈíüÂÜÖÁöÑÂ§ö‰∏™ÊåâÈíÆÁÇπÂáªÔºâ
            
            // ÂÖàÊåâÂàÜÈíüÂàÜÁªÑÔºåÂêàÂπ∂Âêå‰∏ÄÂàÜÈíüÂÜÖÁöÑÂ§ö‰∏™ÊåâÈíÆÁÇπÂáª
            const minuteGroups = {};
            sortedRecords.forEach(record => {
                const date = new Date(record.timestamp);
                const minuteKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
                const sourceKey = `${minuteKey}_${record.source}`;
                
                if (!minuteGroups[sourceKey]) {
                    minuteGroups[sourceKey] = {
                        timestamp: record.timestamp,
                        source: record.source,
                        records: []
                    };
                }
                minuteGroups[sourceKey].records.push(record);
            });
            
            // Â∞ÜÂàÜÈíüÂàÜÁªÑËΩ¨Êç¢‰∏∫ËÆ∞ÂΩïÊï∞ÁªÑÔºàÂêàÂπ∂ÂêéÁöÑÔºâ
            const mergedRecords = Object.values(minuteGroups).map(group => {
                if (group.records.length === 1) {
                    const record = group.records[0];
                    timestampToMergedRecord.set(record.timestamp, record);
                    return record;
                } else {
                    // ÂêàÂπ∂Âêå‰∏ÄÂàÜÈíüÂÜÖÁöÑÂ§ö‰∏™ÊåâÈíÆÁÇπÂáª
                    // ÊåâÈíÆÁ±ªÂûãÂéªÈáçÔºåÂè™ÊòæÁ§∫‰∏ÄÊ¨°
                    const uniqueTypes = [...new Set(group.records.map(r => r.type))];
                    const type = uniqueTypes.join('„ÄÅ');
                    
                    // ÊñáÊú¨‰øùÁïôÊâÄÊúâ‰∏çÂêåÁöÑÂÜÖÂÆπÔºåÁî®ÂàÜÂè∑ËøûÊé•
                    const texts = group.records.map(r => r.text).filter(t => t && t.trim() !== '');
                    // ÂéªÈáç‰ΩÜ‰øùÁïôÈ°∫Â∫è
                    const uniqueTexts = [];
                    const seenTexts = new Set();
                    texts.forEach(t => {
                        if (!seenTexts.has(t)) {
                            seenTexts.add(t);
                            uniqueTexts.push(t);
                        }
                    });
                    const text = uniqueTexts.length > 0 ? uniqueTexts.join('Ôºõ') : '(Êó†ÊñáÂ≠ó)';
                    
                    const merged = {
                        timestamp: group.timestamp,
                        source: group.source,
                        type: type,
                        text: text,
                        merged: true,
                        originalRecords: group.records
                    };
                    // ‰∏∫ÂêàÂπ∂ËÆ∞ÂΩïÁöÑÊâÄÊúâÂéüÂßãÊó∂Èó¥Êà≥Âª∫Á´ãÊò†Â∞Ñ
                    group.records.forEach(r => {
                        timestampToMergedRecord.set(r.timestamp, merged);
                    });
                    return merged;
                }
            });
            
            // Êåâ5ÂàÜÈíüÁ™óÂè£ÂàÜÁªÑ
            const timeGroups = [];
            mergedRecords.forEach(record => {
                // Êü•ÊâæÊòØÂê¶ÊúâÁõ∏ËøëÊó∂Èó¥ÁöÑÁªÑÔºà5ÂàÜÈíüÂÜÖÔºâ
                let foundGroup = false;
                for (let i = 0; i < timeGroups.length; i++) {
                    const groupTime = timeGroups[i].time;
                    if (Math.abs(record.timestamp - groupTime) < TIME_WINDOW) {
                        timeGroups[i].records.push(record);
                        foundGroup = true;
                        break;
                    }
                }
                // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞Áõ∏ËøëÁöÑÁªÑÔºåÂàõÂª∫Êñ∞ÁªÑ
                if (!foundGroup) {
                    timeGroups.push({
                        time: record.timestamp,
                        records: [record]
                    });
                }
            });
            
            // ÊåâÊó∂Èó¥È°∫Â∫èÂ±ïÁ§∫
            timeGroups.sort((a, b) => a.time - b.time).forEach(group => {
                const records = group.records;
                
                // ÂàÜÁ¶ªÂ∑¶Âè≥‰∏§‰æßÁöÑËÆ∞ÂΩï
                // Â∑¶‰æßÊòæÁ§∫ÂàÜ‰∫´ËÄÖÁöÑËÆ∞ÂΩïÔºà[ÊòµÁß∞]ÁöÑËÆ∞ÂΩïÔºâÔºåÂè≥‰æßÊòæÁ§∫ÂΩìÂâçÊü•ÁúãËÄÖÁöÑËÆ∞ÂΩïÔºàÊàëÁöÑËÆ∞ÂΩïÔºâ
                // source: 'other' (ÂàÜ‰∫´ËÄÖ) ÊòæÁ§∫Âú®Â∑¶ËæπÔºåsource: 'my' (ÂΩìÂâçÊü•ÁúãËÄÖ) ÊòæÁ§∫Âú®Âè≥Ëæπ
                const leftRecords = records.filter(r => r.source === 'other').sort((a, b) => a.timestamp - b.timestamp);
                const rightRecords = records.filter(r => r.source === 'my').sort((a, b) => a.timestamp - b.timestamp);
                
                // Â¶ÇÊûúÂêå‰∏Ä‰æßÊúâÂ§ö‰∏™ËÆ∞ÂΩïÔºåÊåâÊó∂Èó¥È°∫Â∫èÂ±ïÁ§∫Ôºà‰∏çÂπ∂ÊéíÔºâ
                if (leftRecords.length > 1 || rightRecords.length > 1) {
                    // ÊåâÊó∂Èó¥È°∫Â∫èÂ±ïÁ§∫ÊâÄÊúâËÆ∞ÂΩï
                    const allRecordsSorted = [...leftRecords, ...rightRecords].sort((a, b) => a.timestamp - b.timestamp);
                    allRecordsSorted.forEach(record => {
                        // source: 'other' (ÂàÜ‰∫´ËÄÖ) Âú®Â∑¶ËæπÔºåsource: 'my' (ÂΩìÂâçÊü•ÁúãËÄÖ) Âú®Âè≥Ëæπ
                        const side = record.source === 'my' ? 'right' : 'left';
                        const isMiracle = isMergedRecordMiracle(record);
                        
                        const rowContainer = document.createElement('div');
                        rowContainer.className = 'timeline-row';
                        
                        if (side === 'left') {
                            const placeholder = document.createElement('div');
                            placeholder.className = 'timeline-item-placeholder';
                            rowContainer.appendChild(placeholder);
                        }
                        
                        const item = document.createElement('div');
                        // Á°Æ‰øùÁ±ªÂêçÊ†ºÂºèÊ≠£Á°ÆÔºötimeline-item left miracle Êàñ timeline-item right miracle
                        item.className = 'timeline-item';
                        item.classList.add(side);
                        if (isMiracle) {
                            item.classList.add('miracle');
                        }
                        
                        const time = new Date(record.timestamp);
                        const timeStr = `${time.getFullYear()}-${String(time.getMonth() + 1).padStart(2, '0')}-${String(time.getDate()).padStart(2, '0')} ${String(time.getHours()).padStart(2, '0')}:${String(time.getMinutes()).padStart(2, '0')}`;
                        
                        item.innerHTML = `
                            <div class="item-time">${timeStr}</div>
                            <div class="item-type">${record.type}</div>
                            <div class="item-text">${record.text || '(Êó†ÊñáÂ≠ó)'}</div>
                        `;
                        
                        rowContainer.appendChild(item);
                        
                        if (side === 'right') {
                            const placeholder = document.createElement('div');
                            placeholder.className = 'timeline-item-placeholder';
                            rowContainer.appendChild(placeholder);
                        }
                        
                        container.appendChild(rowContainer);
                    });
                } else {
                    // Âè™Êúâ‰∏Ä‰∏™Êàñ‰∏§‰∏™ËÆ∞ÂΩïÔºàÂ∑¶Âè≥ÂêÑ‰∏Ä‰∏™ÔºâÔºåÂπ∂ÊéíÊòæÁ§∫
                    // Â¶ÇÊûúÂè™Êúâ‰∏Ä‰æßÊúâËÆ∞ÂΩïÔºå‰∏çÊòæÁ§∫Á©∫ÁöÑplaceholderÔºåÂè™ÊòæÁ§∫ÊúâËÆ∞ÂΩïÁöÑÈÇ£‰∏Ä‰æß
                    if (leftRecords.length === 0 && rightRecords.length === 0) {
                        return; // Ë∑≥ËøáÁ©∫ÁªÑ
                    }
                    
                    const rowContainer = document.createElement('div');
                    rowContainer.className = 'timeline-row';
                    
                    // Â∑¶‰æßËÆ∞ÂΩï
                    if (leftRecords.length > 0) {
                        const record = leftRecords[0];
                        const isMiracle = isMergedRecordMiracle(record);
                        
                        const item = document.createElement('div');
                        item.className = `timeline-item left${isMiracle ? ' miracle' : ''}`;
                        // Á°Æ‰øùÁ±ªÂêçÊ†ºÂºèÊ≠£Á°ÆÔºötimeline-item left miracle
                        if (isMiracle) {
                            item.classList.add('left', 'miracle');
                        } else {
                            item.classList.add('left');
                        }
                        
                        const time = new Date(record.timestamp);
                        const timeStr = `${time.getFullYear()}-${String(time.getMonth() + 1).padStart(2, '0')}-${String(time.getDate()).padStart(2, '0')} ${String(time.getHours()).padStart(2, '0')}:${String(time.getMinutes()).padStart(2, '0')}`;
                        
                        item.innerHTML = `
                            <div class="item-time">${timeStr}</div>
                            <div class="item-type">${record.type}</div>
                            <div class="item-text">${record.text || '(Êó†ÊñáÂ≠ó)'}</div>
                        `;
                        
                        rowContainer.appendChild(item);
                    }
                    // Â¶ÇÊûúÂ∑¶‰æßÊ≤°ÊúâËÆ∞ÂΩïÔºå‰∏çÊ∑ªÂä†placeholder
                    
                    // Âè≥‰æßËÆ∞ÂΩï
                    if (rightRecords.length > 0) {
                        const record = rightRecords[0];
                        const isMiracle = isMergedRecordMiracle(record);
                        
                        const item = document.createElement('div');
                        item.className = `timeline-item right${isMiracle ? ' miracle' : ''}`;
                        // Á°Æ‰øùÁ±ªÂêçÊ†ºÂºèÊ≠£Á°ÆÔºötimeline-item right miracle
                        if (isMiracle) {
                            item.classList.add('right', 'miracle');
                        } else {
                            item.classList.add('right');
                        }
                        
                        const time = new Date(record.timestamp);
                        const timeStr = `${time.getFullYear()}-${String(time.getMonth() + 1).padStart(2, '0')}-${String(time.getDate()).padStart(2, '0')} ${String(time.getHours()).padStart(2, '0')}:${String(time.getMinutes()).padStart(2, '0')}`;
                        
                        item.innerHTML = `
                            <div class="item-time">${timeStr}</div>
                            <div class="item-type">${record.type}</div>
                            <div class="item-text">${record.text || '(Êó†ÊñáÂ≠ó)'}</div>
                        `;
                        
                        rowContainer.appendChild(item);
                    }
                    // Â¶ÇÊûúÂè≥‰æßÊ≤°ÊúâËÆ∞ÂΩïÔºå‰∏çÊ∑ªÂä†placeholder
                    
                    // Âè™ÊúâÂΩìËá≥Â∞ë‰∏Ä‰æßÊúâËÆ∞ÂΩïÊó∂ÊâçÊ∑ªÂä†Âà∞ÂÆπÂô®
                    if (leftRecords.length > 0 || rightRecords.length > 0) {
                        container.appendChild(rowContainer);
                    }
                }
            });
        }


        // Ê∏≤ÊüìÈóÆÈ¢òÂØπÔºàÊó•ËÆ∞ÂºèÂ±ïÁ§∫Ôºâ
        function renderQuestionPairs(myQuestions, otherQuestions, nickname = 'ÂØπÊñπ') {
            const container = document.getElementById('questionPairs');
            container.innerHTML = '';
            
            const questions = [
                'Êú¨Âë®ÂíåÂØπÊñπÁõ∏Â§ÑÊó∂ÔºåÊúÄËÆ©Êàë"ÂæóÂÖ∂ÊÑèÂøòÂΩ¢"Êàñ"ÈÅáËßÅÂ•áËøπ"ÁöÑÁû¨Èó¥ÊòØ‰ªÄ‰πàÔºüÔºàÊó†ÈúÄÂàªÊÑèÁöÑÊùæÂºõ‰∏éÊÑâÊÇ¶„ÄÅÊÑøÊúõ‰ª•ÊÑèÊÉ≥‰∏çÂà∞ÁöÑÂΩ¢ÂºèÂá∫Áé∞Ôºâ',
                'ÂØπÊñπÁöÑÂì™‰∏™Â∞è‰∏æÂä®ËÆ©ÊàëÊÑüÂèóÂà∞"Ë¢´ÁúãËßÅ"Ôºü',
                'ÊàëÊòØÂê¶Áî®"Â∫îËØ•"ÁªëÊû∂‰∫ÜÂØπÊñπÔºüÊç¢Êàê"ÂÄºÂæó"ÁöÑË°®Ëø∞ÊòØ______„ÄÇ',
                'ÊàëËÆ§‰∏∫ÔºåÂØπÊñπÂú®ÂÖ≥Á≥ªÈáåÁöÑ"ËÆ§Áü•Áõ≤Âå∫"ÊòØ‰ªÄ‰πàÔºüÔºàÂ¶ÇÂøΩÁï•ÂØπÊñπÊÉÖÁª™„ÄÅËøáÂ∫¶Ëá™ÊàëÔºâÔºåÂ¶Ç‰ΩïÈÄöËøáÊ≤üÈÄöÂ°´Ë°•Ôºü',
                'Êú¨Âë®ÊúÄÊÑüÊÅ©ÂØπÊñπÁöÑ‰∏ÄÁÇπÊòØ______ÔºåÊÑüÊÅ©Ëá™Â∑±ÁöÑ‰∏ÄÁÇπÊòØ______„ÄÇ',
                'Áî®‰∏ÄÂè•"ÂííËØ≠"ÂΩ¢ÂÆπÊú¨Âë®ÂÖ≥Á≥ªÁä∂ÊÄÅÔºö______„ÄÇ',
                'ÊàëÊÉ≥‰∏∫ÂØπÊñπÂÅöÁöÑ"ÊöñÂøÉÂ∞è‰∫ã"ÊòØ______Ôºå‰∏çÊ±ÇÂõûÊä•‰ΩÜÊ±ÇÁúüÂøÉ„ÄÇ',
                'ÊàëÂ∏åÊúõÂØπÊñπÊîØÊåÅÊàë______ÔºåÊàë‰ºöÁî®______ÊñπÂºèÊ∏ÖÊô∞Ë°®Ëææ„ÄÇ',
                'Ëã•ÈÅáÂà∞ÁüõÁõæÔºåÊàë‰ª¨Á∫¶ÂÆöÁöÑ"ÂÜ∑ÈùôÊ≤üÈÄöÂè•Âºè"ÊòØ______ÔºàÂ¶Ç"ÊàëËØ¥ËØ¥ÊàëÁöÑÊÑüÂèóÔºå‰Ω†Âê¨Âê¨Â∞±Â•Ω"Ôºâ„ÄÇ',
                'ÊàëÂáÜÂ§áÊîæ‰∏ãÁöÑ"ÂÖ≥Á≥ªÂÜÖËÄó"ÊòØ______ÔºàÂ¶ÇËøáÂ∫¶ÊïèÊÑü„ÄÅËøáÂæÄÂøÉÁªìÔºâ„ÄÇ',
                '‰∏ãÂë®ÊÉ≥ÂíåÂØπÊñπÊé¢Á¥¢ÁöÑ"Êñ∞Âú∫ÊôØ"ÊòØ______„ÄÇ',
                'Êàë‰ºöÈÄöËøá______ËÆ©ÂØπÊñπÊÑüÂèóÂà∞"Ë¢´‰ø°‰ªª"„ÄÇ',
                'Êú¨Âë®ÂÖ≥Á≥ªÂÖ≥ÈîÆËØçÔºö______„ÄÇ'
            ];
            
            questions.forEach(question => {
                // Ëé∑ÂèñËØ•ÈóÆÈ¢òÁöÑÊâÄÊúâÂõûÁ≠îÔºàÊï∞ÁªÑÊ†ºÂºèÔºâ
                let myAnswers = [];
                let otherAnswers = [];
                
                if (typeof myQuestions === 'object' && !Array.isArray(myQuestions)) {
                    if (myQuestions[question] && Array.isArray(myQuestions[question])) {
                        myAnswers = myQuestions[question];
                    } else if (myQuestions[question] && myQuestions[question].answer) {
                        // ÂÖºÂÆπÊóßÊ†ºÂºèÔºöÂçï‰∏™ÂØπË±°
                        myAnswers = [myQuestions[question]];
                    } else if (myQuestions.question === question) {
                        // ÂÖºÂÆπÊõ¥ÊóßÁöÑÊ†ºÂºè
                        myAnswers = [{ answer: myQuestions.answer || '', timestamp: Date.now() }];
                    }
                }
                
                if (typeof otherQuestions === 'object' && !Array.isArray(otherQuestions)) {
                    if (otherQuestions[question] && Array.isArray(otherQuestions[question])) {
                        otherAnswers = otherQuestions[question];
                    } else if (otherQuestions[question] && otherQuestions[question].answer) {
                        // ÂÖºÂÆπÊóßÊ†ºÂºèÔºöÂçï‰∏™ÂØπË±°
                        otherAnswers = [otherQuestions[question]];
                    } else if (otherQuestions.question === question) {
                        // ÂÖºÂÆπÊõ¥ÊóßÁöÑÊ†ºÂºè
                        otherAnswers = [{ answer: otherQuestions.answer || '', timestamp: Date.now() }];
                    }
                }
                
                // ÂàÜÁ¶ªÂ∑¶Âè≥‰∏§‰æßÁöÑÂõûÁ≠îÔºåÂàÜÂà´ÊåâÊó∂Èó¥ÊéíÂ∫è
                const sortedMyAnswers = myAnswers.sort((a, b) => a.timestamp - b.timestamp);
                const sortedOtherAnswers = otherAnswers.sort((a, b) => a.timestamp - b.timestamp);
                
                if (sortedMyAnswers.length > 0 || sortedOtherAnswers.length > 0) {
                    const diarySection = document.createElement('div');
                    diarySection.className = 'question-diary';
                    diarySection.innerHTML = `<div class="question-diary-title">${question}</div>`;
                    
                    // ÂàõÂª∫‰∏§ÂàóÂ∏ÉÂ±Ä
                    const columnsContainer = document.createElement('div');
                    columnsContainer.className = 'diary-columns';
                    
                    // Â∑¶‰æßÂàóÔºöÂØπÊñπÁöÑÂõûÁ≠î
                    const leftColumn = document.createElement('div');
                    leftColumn.className = 'diary-column diary-column-left';
                    sortedOtherAnswers.forEach(answer => {
                        const date = new Date(answer.timestamp);
                        const dateStr = `${date.getFullYear()}Âπ¥${date.getMonth() + 1}Êúà${date.getDate()}Êó•`;
                        const entry = document.createElement('div');
                        entry.className = 'diary-entry';
                        entry.innerHTML = `
                            <div class="diary-date">${dateStr} ${nickname}ÁöÑÂõûÁ≠î</div>
                            <div class="diary-content">${answer.answer || '(Êú™ÂõûÁ≠î)'}</div>
                        `;
                        leftColumn.appendChild(entry);
                    });
                    columnsContainer.appendChild(leftColumn);
                    
                    // Âè≥‰æßÂàóÔºöÊàëÁöÑÂõûÁ≠î
                    const rightColumn = document.createElement('div');
                    rightColumn.className = 'diary-column diary-column-right';
                    sortedMyAnswers.forEach(answer => {
                        const date = new Date(answer.timestamp);
                        const dateStr = `${date.getFullYear()}Âπ¥${date.getMonth() + 1}Êúà${date.getDate()}Êó•`;
                        const entry = document.createElement('div');
                        entry.className = 'diary-entry';
                        entry.innerHTML = `
                            <div class="diary-date">${dateStr} ÊàëÁöÑÂõûÁ≠î</div>
                            <div class="diary-content">${answer.answer || '(Êú™ÂõûÁ≠î)'}</div>
                        `;
                        rightColumn.appendChild(entry);
                    });
                    columnsContainer.appendChild(rightColumn);
                    
                    diarySection.appendChild(columnsContainer);
                    container.appendChild(diarySection);
                }
            });
        }

        // ÂàùÂßãÂåñÂ§çÁõòÈ°µÈù¢ÊåâÈíÆ
        function initReview() {
            initReviewButtons();
        }

        // Ê£ÄÊü•Âë®ÈáçÁΩÆ
        function checkWeeklyReset() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0=Âë®Êó•, 1=Âë®‰∏Ä
            
            if (dayOfWeek === 1) { // Âë®‰∏Ä
                // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊ∏ÖÁêÜËøáÔºàÈÄöËøáÊ£ÄÊü•ÊúÄÂêéÊ∏ÖÁêÜÊó•ÊúüÔºâ
                const lastReset = localStorage.getItem('lastResetDate');
                const todayStr = `${today.getFullYear()}-${today.getMonth()}-${today.getDate()}`;
                
                if (lastReset !== todayStr) {
                    localStorage.removeItem(STORAGE_KEY);
                    localStorage.removeItem(QUESTION_STORAGE_KEY);
                    localStorage.setItem('lastResetDate', todayStr);
                }
            }
        }

        // Ê£ÄÊü•Â§çÁõòÊèêÈÜí
        function checkReviewReminder() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0=Âë®Êó•, 1=Âë®‰∏Ä
            
            if (dayOfWeek === 5 || dayOfWeek === 6) { // Âë®‰∫îÊàñÂë®ÂÖ≠
                const modal = document.getElementById('modal');
                const modalCloseBtn = document.getElementById('modalCloseBtn');
                
                modal.classList.add('active');
                
                modalCloseBtn.addEventListener('click', function() {
                    modal.classList.remove('active');
                });
            }
        }
    </script>
</body>
</html>
